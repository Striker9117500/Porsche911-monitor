<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Porsche 911 Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h2 {
            margin-bottom: 10px;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin: 5px 0;
        }
        .logs {
            margin-top: 30px;
            padding: 10px;
            border: 1px solid #ddd;
            background: #f9f9f9;
        }
        button {
            margin-bottom: 15px;
            padding: 8px 12px;
            cursor: pointer;
        }
    </style>
    <script>
        async function manualScrape() {
            const btn = document.getElementById("scrapeBtn");
            btn.disabled = true;
            btn.innerText = "Scraping...";
            try {
                const response = await fetch("/scrape");
                const result = await response.json();
                alert("Scrape Result: " + result.status);
                location.reload(); // reload to show updated listings + logs
            } catch (err) {
                alert("Error running scrape: " + err);
            } finally {
                btn.disabled = false;
                btn.innerText = "Run Manual Scrape";
            }
        }
    </script>
</head>
<body>
    <h1>ðŸš— Live Porsche 911 Listings</h1>

    {% if cars %}
        <ul>
        {% for car in cars %}
            <li>
                <a href="{{ car.url }}" target="_blank">{{ car.title }}</a> - 
                {{ car.price }} - {{ car.mileage }}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No listings yet.</p>
    {% endif %}

    <div class="logs">
        <h2>ðŸ“œ Scrape Logs</h2>
        <button id="scrapeBtn" onclick="manualScrape()">Run Manual Scrape</button>
        <ul>
        {% for log in logs %}
            <li>[{{ log.time }}] ({{ log.type }}) â†’ {{ log.status }}</li>
        {% endfor %}
        </ul>
    </div>
</body>
</html>